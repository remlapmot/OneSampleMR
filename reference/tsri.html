<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="An excellent description of TSRI estimators is given by Terza et al.
(2008). TSRI estimators proceed by fitting a first stage model of the
exposure regressed upon the instruments (and possibly any measured
confounders). From this the first stage residuals are estimated.
A second stage model is then fitted of the outcome regressed upon
the exposure and first stage residuals (and possibly measured
confounders)."><title>Two-stage residual inclusion (TSRI) estimators — tsri • OneSampleMR</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Two-stage residual inclusion (TSRI) estimators — tsri"><meta property="og:description" content="An excellent description of TSRI estimators is given by Terza et al.
(2008). TSRI estimators proceed by fitting a first stage model of the
exposure regressed upon the instruments (and possibly any measured
confounders). From this the first stage residuals are estimated.
A second stage model is then fitted of the outcome regressed upon
the exposure and first stage residuals (and possibly measured
confounders)."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">OneSampleMR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.2.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/compare-smm-fits.html">Comparison fits of the multiplicative structural mean model</a>
    <a class="dropdown-item" href="../articles/f-statistic-comparison.html">Comparison of conditional F-statistics</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/remlapmot/OneSampleMR/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Two-stage residual inclusion (TSRI) estimators</h1>
      <small class="dont-index">Source: <a href="https://github.com/remlapmot/OneSampleMR/blob/HEAD/R/tsri.R" class="external-link"><code>R/tsri.R</code></a></small>
      <div class="d-none name"><code>tsri.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>An excellent description of TSRI estimators is given by Terza et al.
(2008). TSRI estimators proceed by fitting a first stage model of the
exposure regressed upon the instruments (and possibly any measured
confounders). From this the first stage residuals are estimated.
A second stage model is then fitted of the outcome regressed upon
the exposure and first stage residuals (and possibly measured
confounders).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">tsri</span><span class="op">(</span></span>
<span>  <span class="va">formula</span>,</span>
<span>  <span class="va">instruments</span>,</span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">subset</span>,</span>
<span>  <span class="va">na.action</span>,</span>
<span>  contrasts <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  t0 <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  link <span class="op">=</span> <span class="st">"identity"</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>formula</dt>
<dd><p>formula specification(s) of the regression
relationship and the instruments. Either <code>instruments</code> is missing and
<code>formula</code> has three parts as in <code>y ~ x1 + x2 | z1 + z2 + z3</code>
(recommended) or <code>formula</code> is <code>y ~ x1 + x2</code> and <code>instruments</code>
is a one-sided formula <code>~ z1 + z2 + z3</code> (only for backward
compatibility).</p></dd>


<dt>instruments</dt>
<dd><p>formula specification(s) of the regression
relationship and the instruments. Either <code>instruments</code> is missing and
<code>formula</code> has three parts as in <code>y ~ x1 + x2 | z1 + z2 + z3</code>
(recommended) or <code>formula</code> is <code>y ~ x1 + x2</code> and <code>instruments</code>
is a one-sided formula <code>~ z1 + z2 + z3</code> (only for backward
compatibility).</p></dd>


<dt>data</dt>
<dd><p>an optional data frame containing the variables in the model.
By default the variables are taken from the environment of the
<code>formula</code>.</p></dd>


<dt>subset</dt>
<dd><p>an optional vector specifying a subset of observations to be
used in fitting the model.</p></dd>


<dt>na.action</dt>
<dd><p>a function that indicates what should happen when the data
contain <code>NA</code>s. The default is set by the <code>na.action</code> option.</p></dd>


<dt>contrasts</dt>
<dd><p>an optional list. See the <code>contrasts.arg</code> of
<code><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix.default</a></code>.</p></dd>


<dt>t0</dt>
<dd><p>A vector of starting values for the gmm optimizer. This should
have length equal to the number of exposures plus 1.</p></dd>


<dt>link</dt>
<dd><p>character; one of <code>"identity"</code> (the default), <code>"logadd"</code>, <code>"logmult"</code>, <code>"logit"</code>.
This is the link function for the second stage model. <code>"identity"</code> corresponds to linear
regression; <code>"logadd"</code> is log-additive and corresponds to Poisson / log-binomial regression;
<code>"logmult"</code> is log-multiplicative and corresponds to gamma regression;
<code>"logit"</code> corresponds to logistic regression.</p></dd>


<dt>...</dt>
<dd><p>further arguments passed to or from other methods.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>An object of class <code>"tsri"</code> with the following elements</p><dl><dt>fit</dt>
<dd><p>the fitted object of class <code>"gmm"</code> from the call to <a href="https://rdrr.io/pkg/gmm/man/gmm.html" class="external-link">gmm::gmm</a>.</p></dd>

<dt>estci</dt>
<dd><p>a matrix of the estimates with their corresponding confidence interval limits.</p></dd>

<dt>link</dt>
<dd><p>a character vector containing the specificed link function.</p></dd>


</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>TSRI estimators are sometimes described as a special case of
control function estimators.</p>
<p><code>tsri()</code> performs GMM estimation to ensure appropriate standard errors
on its estimates similar to that described that described by
Clarke et al. (2015). Terza (2017) described an alternative approach.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Bowden J, Vansteelandt S.
Mendelian randomization analysis of case-control data using
structural mean models.
Statistics in Medicine, 2011, 30, 6, 678-694.
<a href="https://doi.org/10.1002/sim.4138" class="external-link">doi:10.1002/sim.4138</a></p>
<p>Clarke PS, Palmer TM, Windmeijer F. Estimating structural
mean models with multiple instrumental variables using the
Generalised Method of Moments. Statistical Science, 2015, 30, 1,
96-117. <a href="https://doi.org/10.1214/14-STS503" class="external-link">doi:10.1214/14-STS503</a></p>
<p>Dukes O, Vansteelandt S.
A note on G-estimation of causal risk ratios.
American Journal of Epidemiology, 2018, 187, 5, 1079-1084.
<a href="https://doi.org/10.1093/aje/kwx347" class="external-link">doi:10.1093/aje/kwx347</a></p>
<p>Palmer T, Thompson JR, Tobin MD, Sheehan NA, Burton PR.
Adjusting for bias and unmeasured confounding in Mendelian randomization
studies with binary responses.
International Journal of Epidemiology, 2008, 37, 5, 1161-1168.
<a href="https://doi.org/10.1093/ije/dyn080" class="external-link">doi:10.1093/ije/dyn080</a></p>
<p>Palmer TM, Sterne JAC, Harbord RM, Lawlor DA, Sheehan NA, Meng S,
Granell R, Davey Smith G, Didelez V.
Instrumental variable estimation of causal risk ratios and causal odds ratios
in Mendelian randomization analyses.
American Journal of Epidemiology, 2011, 173, 12, 1392-1403.
<a href="https://doi.org/10.1093/aje/kwr026" class="external-link">doi:10.1093/aje/kwr026</a></p>
<p>Terza JV, Basu A, Rathouz PJ. Two-stage residual inclusion estimation:
Addressing endogeneity in health econometric modeling.
Journal of Health Economics, 2008, 27, 3, 531-543.
<a href="https://doi.org/10.1016/j.jhealeco.2007.09.009" class="external-link">doi:10.1016/j.jhealeco.2007.09.009</a></p>
<p>Terza JV.
Two-stage residual inclusion estimation: A
practitioners guide to Stata implementation.
The Stata Journal, 2017, 17, 4, 916-938.
<a href="https://doi.org/10.1177/1536867X1801700409" class="external-link">doi:10.1177/1536867X1801700409</a></p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Two-stage residual inclusion estimator</span></span></span>
<span class="r-in"><span><span class="co"># with second stage logistic regression</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">9</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span></span>
<span class="r-in"><span><span class="va">psi0</span> <span class="op">&lt;-</span> <span class="fl">0.5</span></span></span>
<span class="r-in"><span><span class="va">Z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">1</span>, <span class="fl">0.5</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">1</span>, <span class="fl">0.7</span><span class="op">*</span><span class="va">Z</span> <span class="op">+</span> <span class="fl">0.2</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">Z</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">m0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fl">0.8</span><span class="op">*</span><span class="va">X</span> <span class="op">-</span> <span class="fl">0.39</span><span class="op">*</span><span class="va">Z</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="va">psi0</span><span class="op">*</span><span class="va">X</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">m0</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">m0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">Z</span>, <span class="va">X</span>, <span class="va">Y</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">tsrilogitfit</span> <span class="op">&lt;-</span> <span class="fu">tsri</span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">X</span> <span class="op">|</span> <span class="va">Z</span> , data <span class="op">=</span> <span class="va">dat</span>, link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">tsrilogitfit</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> GMM fit summary:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> gmm::gmm(g = tsriLogitMoments, x = dat, t0 = t0, vcov = "iid")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Method:  twoStep </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               Estimate    Std. Error  t value     Pr(&gt;|t|)  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Z(Intercept)  1.7647e-01  1.7169e-02  1.0278e+01  8.8297e-25</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ZZ            5.4740e-01  2.6249e-02  2.0854e+01  1.4138e-96</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)   1.0068e+00  1.4482e-01  6.9520e+00  3.6002e-12</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X             6.7047e-01  2.8436e-01  2.3578e+00  1.8382e-02</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> res           4.4657e-01  3.4141e-01  1.3080e+00  1.9086e-01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> J-Test: degrees of freedom is 0 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 J-test                P-value             </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Test E(g)=0:    4.36189434867539e-23  *******             </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> #############</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Information related to the numerical optimization</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Convergence code =  0 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Function eval. =  208 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Gradian eval. =  NA </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Estimates with 95% CI limits:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              Estimate   0.025  0.975</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Z(Intercept)   0.1765  0.1428 0.2101</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ZZ             0.5474  0.4959 0.5988</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)    1.0068  0.7229 1.2906</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X              0.6705  0.1131 1.2278</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> res            0.4466 -0.2226 1.1157</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Causal odds ratio with 95% CI limits:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Estimate  0.025 0.975</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)    2.737 2.0605 3.635</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X              1.955 1.1198 3.414</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> res            1.563 0.8005 3.052</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Tom Palmer, Wes Spiller, Eleanor Sanderson.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer></div>

  

  

  </body></html>

