<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Two-stage predictor substitution (TSPS) estimators — tsps • OneSampleMR</title><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Two-stage predictor substitution (TSPS) estimators — tsps"><meta name="description" content="Terza et al. (2008) give an excellent description of TSPS estimators.
They proceed by fitting a first stage model of the
exposure regressed upon the instruments (and possibly any measured
confounders). From this the predicted values of the exposure are obtained.
A second stage model is then fitted of the outcome regressed upon
the predicted values of the exposure (and possibly measured confounders)."><meta property="og:description" content="Terza et al. (2008) give an excellent description of TSPS estimators.
They proceed by fitting a first stage model of the
exposure regressed upon the instruments (and possibly any measured
confounders). From this the predicted values of the exposure are obtained.
A second stage model is then fitted of the outcome regressed upon
the predicted values of the exposure (and possibly measured confounders)."><meta name="robots" content="noindex"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">OneSampleMR</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.1.5.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/compare-smm-fits.html">Comparison fits of the multiplicative structural mean model</a></li>
    <li><a class="dropdown-item" href="../articles/f-statistic-comparison.html">Comparison of conditional F-statistics</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://cran.r-project.org/package=OneSampleMR" aria-label="View on CRAN"><span class="fa fab fa-r-project"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/remlapmot/OneSampleMR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch"><li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Two-stage predictor substitution (TSPS) estimators</h1>
      <small class="dont-index">Source: <a href="https://github.com/remlapmot/OneSampleMR/blob/main/R/tsps.R" class="external-link"><code>R/tsps.R</code></a></small>
      <div class="d-none name"><code>tsps.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Terza et al. (2008) give an excellent description of TSPS estimators.
They proceed by fitting a first stage model of the
exposure regressed upon the instruments (and possibly any measured
confounders). From this the predicted values of the exposure are obtained.
A second stage model is then fitted of the outcome regressed upon
the predicted values of the exposure (and possibly measured confounders).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">tsps</span><span class="op">(</span></span>
<span>  <span class="va">formula</span>,</span>
<span>  <span class="va">instruments</span>,</span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">subset</span>,</span>
<span>  <span class="va">na.action</span>,</span>
<span>  contrasts <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  t0 <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  link <span class="op">=</span> <span class="st">"identity"</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-formula-instruments">formula, instruments<a class="anchor" aria-label="anchor" href="#arg-formula-instruments"></a></dt>
<dd><p>formula specification(s) of the regression
relationship and the instruments. Either <code>instruments</code> is missing and
<code>formula</code> has three parts as in <code>y ~ x1 + x2 | z1 + z2 + z3</code>
(recommended) or <code>formula</code> is <code>y ~ x1 + x2</code> and <code>instruments</code>
is a one-sided formula <code>~ z1 + z2 + z3</code> (only for backward
compatibility).</p></dd>


<dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>an optional data frame containing the variables in the model.
By default the variables are taken from the environment of the
<code>formula</code>.</p></dd>


<dt id="arg-subset">subset<a class="anchor" aria-label="anchor" href="#arg-subset"></a></dt>
<dd><p>an optional vector specifying a subset of observations to be
used in fitting the model.</p></dd>


<dt id="arg-na-action">na.action<a class="anchor" aria-label="anchor" href="#arg-na-action"></a></dt>
<dd><p>a function that indicates what should happen when the data
contain <code>NA</code>s. The default is set by the <code>na.action</code> option.</p></dd>


<dt id="arg-contrasts">contrasts<a class="anchor" aria-label="anchor" href="#arg-contrasts"></a></dt>
<dd><p>an optional list. See the <code>contrasts.arg</code> of
<code><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">stats::model.matrix()</a></code>.</p></dd>


<dt id="arg-t-">t0<a class="anchor" aria-label="anchor" href="#arg-t-"></a></dt>
<dd><p>A vector of starting values for the gmm optimizer. This should
have length equal to the number of exposures plus 1.</p></dd>


<dt id="arg-link">link<a class="anchor" aria-label="anchor" href="#arg-link"></a></dt>
<dd><p>character; one of <code>"identity"</code> (the default), <code>"logadd"</code>, <code>"logmult"</code>, <code>"logit"</code>.
This is the link function for the second stage model. <code>"identity"</code> corresponds to linear
regression; <code>"logadd"</code> is log-additive and corresponds to Poisson / log-binomial regression;
<code>"logmult"</code> is log-multiplicative and corresponds to gamma regression;
<code>"logit"</code> corresponds to logistic regression.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>further arguments passed to or from other methods.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An object of class <code>"tsps"</code> with the following elements</p><dl><dt>fit</dt>
<dd><p>the fitted object of class <code>"gmm"</code> from the call to <code><a href="https://rdrr.io/pkg/gmm/man/gmm.html" class="external-link">gmm::gmm()</a></code>.</p></dd>

<dt>estci</dt>
<dd><p>a matrix of the estimates with their corresponding confidence interval limits.</p></dd>

<dt>link</dt>
<dd><p>a character vector containing the specified link function.</p></dd>


</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><code>tsps()</code> performs GMM estimation to ensure appropriate standard errors
on its estimates similar to the approach described in Clarke et al. (2015).</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Burgess S, CRP CHD Genetics Collaboration.
Identifying the odds ratio estimated by a
two-stage instrumental variable analysis
with a logistic regression model.
Statistics in Medicine, 2013, 32, 27, 4726-4747.
<a href="https://doi.org/10.1002/sim.5871" class="external-link">doi:10.1002/sim.5871</a></p>
<p>Clarke PS, Palmer TM, Windmeijer F. Estimating structural
mean models with multiple instrumental variables using the
Generalised Method of Moments. Statistical Science, 2015, 30, 1,
96-117. <a href="https://doi.org/10.1214/14-STS503" class="external-link">doi:10.1214/14-STS503</a></p>
<p>Dukes O, Vansteelandt S.
A note on G-estimation of causal risk ratios.
American Journal of Epidemiology, 2018, 187, 5, 1079-1084.
<a href="https://doi.org/10.1093/aje/kwx347" class="external-link">doi:10.1093/aje/kwx347</a></p>
<p>Palmer TM, Sterne JAC, Harbord RM, Lawlor DA, Sheehan NA, Meng S,
Granell R, Davey Smith G, Didelez V.
Instrumental variable estimation of causal risk ratios and causal odds ratios
in Mendelian randomization analyses.
American Journal of Epidemiology, 2011, 173, 12, 1392-1403.
<a href="https://doi.org/10.1093/aje/kwr026" class="external-link">doi:10.1093/aje/kwr026</a></p>
<p>Terza JV, Basu A, Rathouz PJ. Two-stage residual inclusion estimation:
Addressing endogeneity in health econometric modeling.
Journal of Health Economics, 2008, 27, 3, 531-543.
<a href="https://doi.org/10.1016/j.jhealeco.2007.09.009" class="external-link">doi:10.1016/j.jhealeco.2007.09.009</a></p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Two-stage predictor substitution estimator</span></span></span>
<span class="r-in"><span><span class="co"># with second stage logistic regression</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">9</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">n</span>            <span class="op">&lt;-</span> <span class="fl">1000</span></span></span>
<span class="r-in"><span><span class="va">psi0</span>         <span class="op">&lt;-</span> <span class="fl">0.5</span></span></span>
<span class="r-in"><span><span class="va">Z</span>            <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">1</span>, <span class="fl">0.5</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">X</span>            <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">1</span>, <span class="fl">0.7</span><span class="op">*</span><span class="va">Z</span> <span class="op">+</span> <span class="fl">0.2</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">Z</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">m0</span>           <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fl">0.8</span><span class="op">*</span><span class="va">X</span> <span class="op">-</span> <span class="fl">0.39</span><span class="op">*</span><span class="va">Z</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">Y</span>            <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="va">psi0</span><span class="op">*</span><span class="va">X</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">m0</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">m0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dat</span>          <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">Z</span>, <span class="va">X</span>, <span class="va">Y</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">tspslogitfit</span> <span class="op">&lt;-</span> <span class="fu">tsps</span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">X</span> <span class="op">|</span> <span class="va">Z</span> , data <span class="op">=</span> <span class="va">dat</span>, link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">tspslogitfit</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> GMM fit summary:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> gmm::gmm(g = tspsLogitMoments, x = dat, t0 = t0, vcov = "iid")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Method:  twoStep </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               Estimate    Std. Error  t value     Pr(&gt;|t|)  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Z(Intercept)  1.7647e-01  1.7169e-02  1.0278e+01  8.8297e-25</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ZZ            5.4740e-01  2.6249e-02  2.0854e+01  1.4138e-96</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)   9.7133e-01  1.4042e-01  6.9173e+00  4.6027e-12</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> xhat          6.1451e-01  2.7464e-01  2.2375e+00  2.5256e-02</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> J-Test: degrees of freedom is 0 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 J-test               P-value            </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Test E(g)=0:    8.6661572346798e-23  *******            </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> #############</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Information related to the numerical optimization</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Convergence code =  0 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Function eval. =  169 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Gradian eval. =  NA </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Estimates with 95% CI limits:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              Estimate   0.025  0.975</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Z(Intercept)   0.1765 0.14282 0.2101</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ZZ             0.5474 0.49595 0.5988</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)    0.9713 0.69611 1.2465</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> xhat           0.6145 0.07622 1.1528</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Causal odds ratio with 95% CI limits:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Estimate 0.025 0.975</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)    2.641 2.006 3.478</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> xhat           1.849 1.079 3.167</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Tom Palmer, Wes Spiller, Eleanor Sanderson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer></div>





  </body></html>

